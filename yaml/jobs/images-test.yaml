# Requires:
# {name}
# {gituser}
# {gitproject}
# {job_prefix}
# {OS}
# {release}
# {use_hooks}
# {not_automatic}
# {trigger_phrase}
- job-template:
    name: '{job_prefix}-{name}'
    node: sclo-sig||slave_rhel{release}_root
    scm:
        - images-pull-test:
            gituser: '{gituser}'
            gitproject: '{gitproject}'
    triggers:
        - github-pr:
            context: '{context}'
            use_hooks: '{use_hooks}'
            not_automatic: '{not_automatic}'
            trigger_phrase: '{trigger_phrase}'
    builders:
        - add_dependencies_remote:
            name: '{name}'
        - prepare-{OS}:
            release: '{release}'
        - shell: |
            #!/bin/bash
            set -ex

            # Copy sources and prepare shared sources (build scripts)
            rsync -avzP -e 'ssh -F ssh_config' $(pwd)/ host:sources
            ssh -F ssh_config host 'cd sources && git submodule update --init'

        - image-{trigger_phrase}:
            OS: '{OS}'
            release: '{release}'
    publishers:
        - release-vm
