# Requires:
# {targetOS}
- builder:
    name: 'image-test-openshift-4'
    builders:
        - shell: |
            #!/bin/bash
            set -ex

            # Download kubeconfig
            curl -L https://url.corp.redhat.com/ocp-kubeconfig >/root/.kube/config
            # Download kubepasswd
            curl -L https://url.corp.redhat.com/kube >/root/.kube/ocp-kube

            # Run make for base image and for each dependent image
            timeout 2h ssh -F ssh_config host 'set -ex; \
              cd sources; make test-openshift-4 TARGET={targetOS} UPDATE_BASE=1 TAG_ON_SUCCESS=true;'
